<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TumeloGaming â€” Admin</title>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Syne:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg:#06060f; --surface:rgba(255,255,255,0.04); --surface2:rgba(255,255,255,0.07);
    --border:rgba(255,255,255,0.08); --accent:#8b5cf6; --accent2:#06b6d4; --accent3:#f472b6;
    --text:#e2e8f0; --muted:#64748b; --dim:#94a3b8;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;}
  #login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;}
  .login-card{background:#0e0e1c;border:1px solid rgba(139,92,246,0.25);border-radius:24px;padding:48px 40px;text-align:center;max-width:380px;width:100%;}
  .login-logo{font-family:'Orbitron',monospace;font-size:28px;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.08em;margin-bottom:8px;display:block;}
  .login-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:0.12em;margin-bottom:32px;}
  .btn-login{display:inline-flex;align-items:center;gap:10px;padding:13px 28px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6d28d9);color:#fff;border:none;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.25s;letter-spacing:0.03em;}
  .btn-login:hover{transform:translateY(-2px);box-shadow:0 0 40px rgba(139,92,246,0.4);}

  #app{display:none;}
  .topbar{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(6,6,15,0.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 32px;height:60px;display:flex;align-items:center;justify-content:space-between;}
  .topbar-logo{font-family:'Orbitron',monospace;font-size:14px;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.1em;}
  .topbar-right{display:flex;align-items:center;gap:12px;}
  .btn-view{display:inline-flex;align-items:center;gap:6px;padding:7px 16px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--dim);font-family:'Syne',sans-serif;font-size:12px;font-weight:600;text-decoration:none;transition:all 0.2s;cursor:pointer;}
  .btn-view:hover{border-color:rgba(6,182,212,0.4);color:var(--accent2);}
  .btn-publish{display:inline-flex;align-items:center;gap:8px;padding:8px 20px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6d28d9);color:#fff;border:none;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.25s;letter-spacing:0.02em;}
  .btn-publish:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(139,92,246,0.4);}
  .btn-publish:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
  .btn-signout{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'JetBrains Mono',monospace;font-size:11px;cursor:pointer;transition:all 0.2s;letter-spacing:0.05em;}
  .btn-signout:hover{border-color:rgba(244,114,182,0.4);color:var(--accent3);}

  .main{padding:80px 0 60px;max-width:900px;margin:0 auto;padding-left:32px;padding-right:32px;}

  /* toast */
  .toast{position:fixed;bottom:32px;left:50%;transform:translateX(-50%) translateY(20px);z-index:999;padding:12px 24px;border-radius:12px;font-family:'JetBrains Mono',monospace;font-size:12px;letter-spacing:0.06em;opacity:0;transition:all 0.35s;pointer-events:none;white-space:nowrap;}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
  .toast.ok{background:rgba(34,197,94,0.15);border:1px solid rgba(34,197,94,0.3);color:#4ade80;}
  .toast.err{background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);color:#f87171;}

  /* section cards */
  .sec-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:28px 32px;margin-bottom:20px;}
  .sec-card-title{font-family:'Orbitron',monospace;font-size:14px;font-weight:700;color:var(--text);letter-spacing:0.05em;margin-bottom:24px;display:flex;align-items:center;gap:10px;}
  .sec-card-title::before{content:'';display:block;width:3px;height:16px;background:var(--accent);border-radius:2px;flex-shrink:0;}

  label{display:block;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:6px;}
  input[type=text],input[type=url],input[type=email],textarea,select{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;outline:none;transition:border-color 0.2s;letter-spacing:0.02em;}
  input[type=text]:focus,input[type=url]:focus,input[type=email]:focus,textarea:focus,select:focus{border-color:rgba(139,92,246,0.45);}
  textarea{resize:vertical;min-height:72px;line-height:1.6;}
  select{cursor:pointer;}
  option{background:#0e0e1c;}
  .field{margin-bottom:18px;}
  .field-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
  .field-row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}

  /* toggle switch */
  .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:10px;margin-bottom:12px;}
  .toggle-label{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--dim);letter-spacing:0.05em;}
  .toggle{position:relative;width:42px;height:24px;flex-shrink:0;}
  .toggle input{opacity:0;width:0;height:0;}
  .slider{position:absolute;inset:0;background:rgba(255,255,255,0.1);border-radius:100px;cursor:pointer;transition:background 0.3s;}
  .slider::before{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;left:3px;top:3px;transition:transform 0.3s;}
  input:checked + .slider{background:var(--accent);}
  input:checked + .slider::before{transform:translateX(18px);}

  /* list items */
  .list-item{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:14px;padding:20px 22px;margin-bottom:12px;position:relative;}
  .list-item-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
  .list-item-title{font-family:'Orbitron',monospace;font-size:12px;font-weight:700;color:var(--text);letter-spacing:0.04em;}
  .btn-remove{background:none;border:none;color:var(--muted);cursor:pointer;font-size:16px;padding:4px;border-radius:6px;transition:color 0.2s;line-height:1;}
  .btn-remove:hover{color:#f87171;}
  .btn-add{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;border-radius:10px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.25);color:var(--accent);font-family:'JetBrains Mono',monospace;font-size:11px;cursor:pointer;transition:all 0.2s;letter-spacing:0.06em;margin-top:4px;}
  .btn-add:hover{background:rgba(139,92,246,0.18);border-color:rgba(139,92,246,0.4);}

  /* skills tags */
  .skills-wrap{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
  .skill-tag{display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border-radius:100px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.2);font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--accent);}
  .skill-tag button{background:none;border:none;color:var(--muted);cursor:pointer;font-size:13px;line-height:1;padding:0;transition:color 0.2s;}
  .skill-tag button:hover{color:#f87171;}
  .skills-add-row{display:flex;gap:8px;}
  .skills-add-row input{flex:1;}
  .btn-skill-add{padding:9px 16px;border-radius:10px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.25);color:var(--accent);font-family:'JetBrains Mono',monospace;font-size:11px;cursor:pointer;transition:all 0.2s;white-space:nowrap;}
  .btn-skill-add:hover{background:rgba(139,92,246,0.18);}

  /* platform icon selector */
  .plat-selector{display:flex;gap:8px;flex-wrap:wrap;}
  .plat-btn{width:38px;height:38px;border-radius:10px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;}
  .plat-btn:hover,.plat-btn.active{border-color:rgba(139,92,246,0.5);background:rgba(139,92,246,0.12);}
  .plat-btn.active{border-color:var(--accent);}
  input[type=hidden]{}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-card">
    <span class="login-logo">TUMELOGAMING</span>
    <p class="login-sub">// Admin Panel</p>
    <button class="btn-login" onclick="netlifyIdentity.open()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
      Continue with GitHub
    </button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="topbar">
    <span class="topbar-logo">TG // ADMIN</span>
    <div class="topbar-right">
      <a href="/" target="_blank" class="btn-view">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        View Site
      </a>
      <button class="btn-publish" id="publish-btn" onclick="publishChanges()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>
        Publish Changes
      </button>
      <button class="btn-signout" onclick="netlifyIdentity.logout()">Sign Out</button>
    </div>
  </div>

  <div class="main" id="editor-root">
    <!-- dynamically built -->
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let content = {};

// â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
netlifyIdentity.on('init', u => u ? showApp() : null);
netlifyIdentity.on('login', () => { netlifyIdentity.close(); showApp(); });
netlifyIdentity.on('logout', () => { document.getElementById('app').style.display='none'; document.getElementById('login-screen').style.display='flex'; });

function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  loadContent();
}

async function loadContent() {
  try {
    const res = await fetch('/content.json?_=' + Date.now());
    content = await res.json();
    // migrate old format
    if (!content.hero.skills && content.hero.badges) content.hero.skills = content.hero.badges;
    if (!content.hero.stats) content.hero.stats = { servers: '14', experience: '3+' };
    if (!content.contact) content.contact = { discord: '', discordUrl: '', email: '' };
    if (!Array.isArray(content.hero.socials)) {
      content.hero.socials = [
        { id:'twitch',  label:'Twitch',  url: content.hero.socials?.twitch  || '', enabled: !!content.hero.socials?.twitch },
        { id:'tiktok',  label:'TikTok',  url: content.hero.socials?.tiktok  || '', enabled: !!content.hero.socials?.tiktok },
        { id:'twitter', label:'Twitter', url: '', enabled: false },
        { id:'youtube', label:'YouTube', url: '', enabled: false },
      ];
    }
    buildEditor();
  } catch(e) { toast('Failed to load content', true); }
}

// â”€â”€ EDITOR BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildEditor() {
  const root = document.getElementById('editor-root');
  root.innerHTML = '';
  root.appendChild(buildHeroSection());
  root.appendChild(buildPositionsSection());
  root.appendChild(buildProjectsSection());
  root.appendChild(buildServersSection());
  root.appendChild(buildContactSection());
  root.appendChild(buildFooterSection());
}

function field(label, inputHtml, id='') {
  return `<div class="field"><label>${label}</label>${inputHtml}</div>`;
}
function inp(id, val, type='text', placeholder='') {
  return `<input type="${type}" id="${id}" value="${esc(val)}" placeholder="${placeholder}" oninput="syncField('${id}')"/>`;
}
function tex(id, val, placeholder='') {
  return `<textarea id="${id}" placeholder="${placeholder}" oninput="syncField('${id}')">${esc(val)}</textarea>`;
}
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildHeroSection() {
  const h = content.hero;
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.innerHTML = `
    <p class="sec-card-title">Hero</p>
    <div class="field-row">
      ${field('Name Line 1', inp('h-name1', h.name1))}
      ${field('Name Line 2', inp('h-name2', h.name2))}
    </div>
    ${field('Pronouns', inp('h-pronouns', h.pronouns || 'he/him'))}
    ${field('Bio / Tagline', tex('h-bio', h.tagline))}
    <div class="field-row">
      ${field('Stat â€” MC Servers', inp('h-stat-srv', h.stats?.servers || '14'))}
      ${field('Stat â€” Years Exp', inp('h-stat-exp', h.stats?.experience || '3+'))}
    </div>

    <label style="margin-bottom:10px">Skills (Marquee)</label>
    <div class="skills-wrap" id="skills-wrap"></div>
    <div class="skills-add-row">
      <input type="text" id="skill-new-input" placeholder="e.g. ğŸ® New Skill" onkeydown="if(event.key==='Enter'){event.preventDefault();addSkill();}"/>
      <button class="btn-skill-add" onclick="addSkill()">+ Add</button>
    </div>

    <div style="margin-top:24px">
      <label style="margin-bottom:12px">Social Links</label>
      <div id="socials-list"></div>
    </div>
  `;
  setTimeout(() => { renderSkills(); renderSocials(); }, 0);
  return div;
}

function renderSkills() {
  const wrap = document.getElementById('skills-wrap');
  if (!wrap) return;
  wrap.innerHTML = (content.hero.skills||[]).map((s,i) =>
    `<span class="skill-tag">${esc(s)}<button onclick="removeSkill(${i})">Ã—</button></span>`
  ).join('');
}
function addSkill() {
  const inp = document.getElementById('skill-new-input');
  const val = inp.value.trim();
  if (!val) return;
  if (!content.hero.skills) content.hero.skills = [];
  content.hero.skills.push(val);
  inp.value = '';
  renderSkills();
}
function removeSkill(i) { content.hero.skills.splice(i,1); renderSkills(); }

function renderSocials() {
  const list = document.getElementById('socials-list');
  if (!list) return;
  list.innerHTML = (content.hero.socials||[]).map((s,i) => `
    <div class="toggle-row">
      <span class="toggle-label">${s.label}</span>
      <div style="display:flex;align-items:center;gap:12px;flex:1;margin-left:16px;">
        <input type="url" value="${esc(s.url)}" placeholder="https://..." style="flex:1;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:8px;padding:7px 12px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px;outline:none;" oninput="content.hero.socials[${i}].url=this.value"/>
      </div>
      <label class="toggle" style="margin-left:12px;">
        <input type="checkbox" ${s.enabled?'checked':''} onchange="content.hero.socials[${i}].enabled=this.checked"/>
        <span class="slider"></span>
      </label>
    </div>
  `).join('');
}

// â”€â”€ POSITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPositionsSection() {
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.id = 'positions-section';
  renderPositions(div);
  return div;
}
function renderPositions(container) {
  if (!container) container = document.getElementById('positions-section');
  container.innerHTML = `<p class="sec-card-title">Current Positions</p>` +
    (content.positions||[]).map((p,i) => `
    <div class="list-item">
      <div class="list-item-header">
        <span class="list-item-title">${esc(p.title)||'Position '+(i+1)}</span>
        <button class="btn-remove" onclick="removePosition(${i})">âœ•</button>
      </div>
      <div class="field-row">
        ${field('Icon (emoji)', `<input type="text" value="${esc(p.icon)}" oninput="content.positions[${i}].icon=this.value" style="width:80px"/>`)}
        ${field('Tag Label', `<input type="text" value="${esc(p.tag)}" oninput="content.positions[${i}].tag=this.value"/>`)}
        ${field('Tag Color', `<select onchange="content.positions[${i}].tagColor=this.value"><option value="cyan" ${p.tagColor==='cyan'?'selected':''}>Cyan</option><option value="purple" ${p.tagColor==='purple'?'selected':''}>Purple</option><option value="pink" ${p.tagColor==='pink'?'selected':''}>Pink</option></select>`)}
      </div>
      ${field('Title', `<input type="text" value="${esc(p.title)}" oninput="content.positions[${i}].title=this.value"/>`)}
      ${field('Subtitle', `<input type="text" value="${esc(p.subtitle)}" oninput="content.positions[${i}].subtitle=this.value"/>`)}
      ${field('Description', `<textarea oninput="content.positions[${i}].description=this.value">${esc(p.description)}</textarea>`)}
      <div class="field-row">
        ${field('Link URL', `<input type="url" value="${esc(p.link)}" oninput="content.positions[${i}].link=this.value"/>`)}
        ${field('Link Text', `<input type="text" value="${esc(p.linkText)}" oninput="content.positions[${i}].linkText=this.value"/>`)}
      </div>
    </div>`).join('') +
    `<button class="btn-add" onclick="addPosition()">+ Add Position</button>`;
}
function removePosition(i) { content.positions.splice(i,1); renderPositions(); }
function addPosition() {
  content.positions.push({ id:'pos'+Date.now(), icon:'âœ¦', title:'New Position', subtitle:'', description:'', link:'', linkText:'Learn More', tag:'Active', tagColor:'cyan' });
  renderPositions();
}

// â”€â”€ PROJECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PLAT_ICONS_SVG = {
  discord: `<svg width="13" height="13" viewBox="0 0 24 24" fill="#5865f2"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057c.002.022.015.043.03.056a19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>`,
  github:  `<svg width="13" height="13" viewBox="0 0 24 24" fill="rgba(255,255,255,0.7)"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>`,
  web:     `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>`,
  mc:      `<svg width="13" height="13" viewBox="0 0 24 24" fill="#4ade80"><rect x="2" y="2" width="9" height="9" rx="1"/><rect x="13" y="2" width="9" height="9" rx="1"/><rect x="2" y="13" width="9" height="9" rx="1"/><rect x="13" y="13" width="9" height="9" rx="1"/></svg>`,
  youtube: `<svg width="13" height="13" viewBox="0 0 24 24" fill="#ef4444"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>`,
  twitch:  `<svg width="13" height="13" viewBox="0 0 24 24" fill="#8b5cf6"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/></svg>`,
};

function buildProjectsSection() {
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.id = 'projects-section';
  renderProjects(div);
  return div;
}
function renderProjects(container) {
  if (!container) container = document.getElementById('projects-section');
  container.innerHTML = `<p class="sec-card-title">Projects</p>` +
    (content.projects||[]).map((p,i) => `
    <div class="list-item">
      <div class="list-item-header">
        <span class="list-item-title">${esc(p.title)||'Project '+(i+1)}</span>
        <button class="btn-remove" onclick="removeProject(${i})">âœ•</button>
      </div>
      ${field('Title', `<input type="text" value="${esc(p.title)}" oninput="content.projects[${i}].title=this.value"/>`)}
      ${field('Description', `<textarea oninput="content.projects[${i}].description=this.value">${esc(p.description)}</textarea>`)}
      <div class="field-row">
        ${field('Link URL', `<input type="url" value="${esc(p.link)}" oninput="content.projects[${i}].link=this.value"/>`)}
        ${field('Link Text', `<input type="text" value="${esc(p.linkText)}" oninput="content.projects[${i}].linkText=this.value"/>`)}
      </div>
      <div class="field-row">
        ${field('Emoji Icon (fallback)', `<input type="text" value="${esc(p.pfpEmoji||'ğŸ› ï¸')}" oninput="content.projects[${i}].pfpEmoji=this.value" style="width:80px"/>`)}
        ${field('Avatar Image URL (optional)', `<input type="url" value="${esc(p.pfp||'')}" placeholder="https://cdn.discordapp.com/..." oninput="content.projects[${i}].pfp=this.value"/>`)}
      </div>
      <label style="margin-bottom:10px">Platform Icon</label>
      <div class="plat-selector">
        ${Object.keys(PLAT_ICONS_SVG).map(k => `
          <button class="plat-btn ${(p.platform||'web')===k?'active':''}" title="${k}" onclick="setPlatform(${i},'${k}',this)">
            ${PLAT_ICONS_SVG[k]}
          </button>`).join('')}
      </div>
    </div>`).join('') +
    `<button class="btn-add" onclick="addProject()">+ Add Project</button>`;
}
function setPlatform(i, plat, btn) {
  content.projects[i].platform = plat;
  btn.closest('.plat-selector').querySelectorAll('.plat-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}
function removeProject(i) { content.projects.splice(i,1); renderProjects(); }
function addProject() {
  content.projects.push({ id:'proj'+Date.now(), title:'New Project', description:'', link:'', linkText:'View Project', pfp:'', pfpEmoji:'ğŸ› ï¸', platform:'web' });
  renderProjects();
}

// â”€â”€ SERVERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildServersSection() {
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.id = 'servers-section';
  renderServers(div);
  return div;
}
function renderServers(container) {
  if (!container) container = document.getElementById('servers-section');
  const colorOpts = ['mod','admin','manager','dev','exec','builder'];
  container.innerHTML = `<p class="sec-card-title">Server Experience</p>
    <p style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:20px;">${(content.servers||[]).length} servers listed</p>` +
    (content.servers||[]).map((s,i) => `
    <div class="list-item" style="padding:14px 18px;margin-bottom:8px;">
      <div style="display:grid;grid-template-columns:1fr 120px 120px 32px;gap:10px;align-items:center;">
        <input type="text" value="${esc(s.name)}" placeholder="Server Name" oninput="content.servers[${i}].name=this.value"/>
        <input type="text" value="${esc(s.role)}" placeholder="Role" oninput="content.servers[${i}].role=this.value"/>
        <select onchange="content.servers[${i}].color=this.value">
          ${colorOpts.map(c => `<option value="${c}" ${s.color===c?'selected':''}>${c}</option>`).join('')}
        </select>
        <button class="btn-remove" onclick="removeServer(${i})" style="width:32px;height:32px;display:flex;align-items:center;justify-content:center;">âœ•</button>
      </div>
    </div>`).join('') +
    `<button class="btn-add" onclick="addServer()">+ Add Server</button>`;
}
function removeServer(i) { content.servers.splice(i,1); renderServers(); }
function addServer() { content.servers.push({ name:'New Server', role:'Mod', color:'mod' }); renderServers(); }

// â”€â”€ CONTACT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildContactSection() {
  const c = content.contact || {};
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.innerHTML = `
    <p class="sec-card-title">Contact Info (Popup)</p>
    ${field('Discord Handle', `<input type="text" value="${esc(c.discord)}" placeholder="@yourdiscord" oninput="content.contact.discord=this.value"/>`)}
    ${field('Discord URL (optional direct link)', `<input type="url" value="${esc(c.discordUrl||'')}" placeholder="https://discord.com/users/..." oninput="content.contact.discordUrl=this.value"/>`)}
    ${field('Email (leave blank to hide)', `<input type="email" value="${esc(c.email||'')}" placeholder="your@email.com" oninput="content.contact.email=this.value"/>`)}
  `;
  return div;
}

// â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildFooterSection() {
  const f = content.footer || {};
  const div = document.createElement('div');
  div.className = 'sec-card';
  div.innerHTML = `
    <p class="sec-card-title">Footer</p>
    ${field('Credit Text', `<input type="text" value="${esc(f.credit)}" oninput="content.footer.credit=this.value"/>`)}
  `;
  return div;
}

// â”€â”€ SYNC simple field â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function syncField(id) {
  const val = document.getElementById(id)?.value || '';
  const map = {
    'h-name1':    () => content.hero.name1 = val,
    'h-name2':    () => content.hero.name2 = val,
    'h-pronouns': () => content.hero.pronouns = val,
    'h-bio':      () => content.hero.tagline = val,
    'h-stat-srv': () => { if(!content.hero.stats) content.hero.stats={}; content.hero.stats.servers = val; },
    'h-stat-exp': () => { if(!content.hero.stats) content.hero.stats={}; content.hero.stats.experience = val; },
  };
  if (map[id]) map[id]();
}

// â”€â”€ PUBLISH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function publishChanges() {
  const btn = document.getElementById('publish-btn');
  btn.disabled = true; btn.textContent = 'Publishingâ€¦';
  try {
    const user = netlifyIdentity.currentUser();
    const token = await user.jwt();
    const res = await fetch('/.netlify/functions/save-content', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
      body: JSON.stringify(content)
    });
    const data = await res.json();
    if (res.ok) { toast('Changes published! Site rebuildingâ€¦', false); }
    else { toast('Error: ' + (data.error || data.message || 'Unknown'), true); }
  } catch(e) { toast('Network error: ' + e.message, true); }
  finally { btn.disabled = false; btn.innerHTML = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg> Publish Changes`; }
}

function toast(msg, isErr) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'toast show ' + (isErr ? 'err' : 'ok');
  setTimeout(() => el.classList.remove('show'), 3800);
}
</script>
</body>
</html>
